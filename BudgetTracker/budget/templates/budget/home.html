{% extends "budget/base.html" %} 
{% block title %}<title>Budget Tracker</title>{% endblock title %}
{% block static %} 
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'budget/home.css' %}">
{% endblock static %}
{% block google_charts %}
 <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
 <script type="text/javascript">
   google.charts.load('current', {'packages':['corechart','table']});
   google.charts.setOnLoadCallback(drawPieChart);
   google.charts.setOnLoadCallback(drawTableChart);

   function drawPieChart() {
     var data = new google.visualization.arrayToDataTable({{ pie_data|safe }});
     var options = {'title':'Total Spent',
                    'width':400,
                    'height':300};
     var chart = new google.visualization.PieChart(document.getElementById('pie_chart'));
     chart.draw(data, options);
   }

   function drawTableChart() {
     var data = new google.visualization.arrayToDataTable({{ table_data|safe }});
     var options = {'title':'Total Spent',
                    showRowNumber: true,
                    width: '100%',
                    height: '100%',
                };
     var chart = new google.visualization.Table(document.getElementById('table_chart'));
     chart.draw(data, options);
   }
 </script>
{% endblock google_charts %}

{% block content %}
    {% if user.is_authenticated and has_budget %}
        <h2 class="text-center">Welcome, {{ user.username }}</h2>
        <h3 class="text-center">{{ budget_message }} </h3>
        <h4 class="text-center">{{ remaining_allowance }}</h4>
        {{ pie_data_length }}
        {% if user_transactions %}
            <div id="pie_chart"></div>
            <div style="width: 400px;">
                <div id="table_chart"></div>
            </div>
            {% for k,v in spent_percentages.items %}
                    <span>{{ k }}</span>
                    <span>${{ v.spent }} out of ${{ v.allowance }}</span>
                    <div style="width: 600px;">
                        {% if v.spent > v.allowance %}
                            <div class="progress">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 100%" 
                                    aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        {% elif v.spent == v.allowance %}
                            <div class="progress">
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 100%" 
                                    aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        {% else %}
                            <div class="progress">
                                <div class="progress-bar bg-success" role="progressbar" style="width: {{v.percentage_spent}}%" 
                                    aria-valuenow="{{v.percentage_spent}}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        {% endif %}
            {% endfor %}
        {% endif %}
                    </div>
    {% elif user.is_authenticated and not has_budget %}
        <h2 class="text-center">Welcome, {{ user.username }}</h2>
        <h3 class="text-center">Start your budget today.</h3>
        <form class="text-center" action="{% url 'add_categories' %}">
            <input type="submit" value="Begin" />
        </form>
    {% else %}
        <h2 class="text-center">Start your budget today.</h2>
        <form class="text-center" action="{% url 'login' %}">
            <input type="submit" value="Begin" />
        </form>
    {% endif %}
{% endblock content %}
